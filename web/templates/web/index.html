{% extends 'web/base.html' %}
{% load static %}

{% block html_attributes %}{% endblock %}
{% block meta_translation %}{% endblock %}

{% block content %}
{% include 'web/includes/_hero.html' %}
{% include 'web/includes/_marquee.html' %}
{% include 'web/includes/_features.html' %}
{% include 'web/includes/_demo.html' %}
{% include 'web/includes/_signup.html' %}
{% include 'web/includes/_pricing.html' %}
{% include 'web/includes/_subscription_modal.html' %}
{% include 'web/includes/_advertising_modal.html' %}
{% include 'web/includes/_waiting_list_modal.html' %}
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'web/js/waiting-list.js' %}"></script>

<script>
    // PWA Smart Redirect - Send returning users directly to feed
    (function () {
        // Check if user has visited before
        const hasVisited = localStorage.getItem('gist4u_has_visited');

        // Check if opened as PWA (standalone mode)
        const isPWA = window.matchMedia('(display-mode: standalone)').matches ||
            window.navigator.standalone === true;

        // If returning user and opening from PWA, redirect to feed
        if (hasVisited && isPWA && !window.location.search.includes('from=promo')) {
            console.log('[PWA] Returning user detected - redirecting to feed');
            window.location.href = '/feed/';
        } else {
            // Mark that user has visited
            localStorage.setItem('gist4u_has_visited', 'true');
            console.log('[PWA] First visit or browser mode - showing landing page');
        }
    })();
</script>
{% endblock %}